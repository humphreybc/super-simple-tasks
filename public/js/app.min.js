var __slice=[].slice;!function(a){var b,c,d,e,f,g,h,i,j,k,l;return e=a.tourbus=function(){var b,c;return b=1<=arguments.length?__slice.call(arguments,0):[],c=b[0],d.hasOwnProperty(c)?b=b.slice(1):c instanceof a?c="build":"string"==typeof c?(c="build",b[0]=a(b[0])):a.error("Unknown method of $.tourbus --",b),d[c].apply(this,b)},a.fn.tourbus=function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],this.each(function(){return b.unshift(a(this)),e.apply(null,["build"].concat(__slice.call(b))),this})},d={build:function(b,c){var d;return null==c&&(c={}),c=a.extend(!0,{},e.defaults,c),d=[],b instanceof a||(b=a(b)),b.each(function(){return d.push(h(this,c))}),0===d.length&&a.error(""+b.selector+" was not found!"),1===d.length?d[0]:d},destroyAll:function(){var a,b,c;c=[];for(b in i)a=i[b],c.push(a.destroy());return c},expose:function(a){return a.tourbus={Bus:b,Leg:c}}},e.defaults={debug:!1,autoDepart:!1,target:"body",startAt:0,onDepart:function(){return null},onStop:function(){return null},onLegStart:function(){return null},onLegEnd:function(){return null},leg:{scrollTo:null,scrollSpeed:150,scrollContext:100,orientation:"bottom",align:"left",width:"auto",margin:10,top:null,left:null,arrow:"50%"}},b=function(){function b(b,c){this.id=f(),this.$target=a(c.target),this.$el=a(b),this.$el.data({tourbus:this}),this.options=c,this.currentLegIndex=null,this.legs=null,this.legEls=this.$el.children("li"),this.totalLegs=this.legEls.length,this._setupEvents(),this.options.autoDepart&&this.$el.trigger("depart.tourbus"),this._log("built tourbus with el",b.toString(),"and options",this.options)}return b.prototype.depart=function(){return this.running=!0,this.options.onDepart(this),this._log("departing",this),this.legs=this._buildLegs(),this.currentLegIndex=this.options.startAt,this.showLeg()},b.prototype.stop=function(){return this.running?(this.legs&&a.each(this.legs,a.proxy(this.hideLeg,this)),this.currentLegIndex=this.options.startAt,this.options.onStop(this),this.running=!1):void 0},b.prototype.on=function(a,b,c){return this.$target.on(a,b,c)},b.prototype.currentLeg=function(){return null===this.currentLegIndex?null:this.legs[this.currentLegIndex]},b.prototype.showLeg=function(a){var b,c;return null==a&&(a=this.currentLegIndex),b=this.legs[a],this._log("showLeg:",b),c=this.options.onLegStart(b,this),c!==!1?b.show():void 0},b.prototype.hideLeg=function(a){var b,c;return null==a&&(a=this.currentLegIndex),b=this.legs[a],this._log("hideLeg:",b),c=this.options.onLegEnd(b,this),c!==!1?b.hide():void 0},b.prototype.repositionLegs=function(){return this.legs?a.each(this.legs,function(){return this.reposition()}):void 0},b.prototype.next=function(){return this.hideLeg(),this.currentLegIndex++,this.currentLegIndex>this.totalLegs-1?this.stop():this.showLeg()},b.prototype.prev=function(){return this.hideLeg(),this.currentLegIndex--,this.currentLegIndex<0?this.stop():this.showLeg()},b.prototype.destroy=function(){return this.legs&&a.each(this.legs,function(){return this.destroy()}),this.legs=null,delete i[this.id],this._teardownEvents()},b.prototype._buildLegs=function(){var b=this;return this.legs&&a.each(this.legs,function(a,b){return b.destroy()}),a.map(this.legEls,function(d,e){var f,g,h;return f=a(d),g=f.data(),h=new c({content:f.html(),target:g.el||"body",bus:b,index:e,rawData:g}),h.render(),b.$target.append(h.$el),h._position(),h.hide(),h})},b.prototype._log=function(){return this.options.debug?console.log.apply(console,["TOURBUS "+this.id+":"].concat(__slice.call(arguments))):void 0},b.prototype._setupEvents=function(){return this.$el.on("depart.tourbus",a.proxy(this.depart,this)),this.$el.on("stop.tourbus",a.proxy(this.stop,this)),this.$el.on("next.tourbus",a.proxy(this.next,this)),this.$el.on("prev.tourbus",a.proxy(this.prev,this))},b.prototype._teardownEvents=function(){return this.$el.off(".tourbus")},b}(),c=function(){function b(b){if(this.bus=b.bus,this.rawData=b.rawData,this.content=b.content,this.index=b.index,this.options=b,this.$target=a(b.target),0===this.$target.length)throw""+this.$target.selector+" is not an element!";this._setupOptions(),this._configureElement(),this._configureTarget(),this._configureScroll(),this._setupEvents(),this.bus._log("leg "+this.index+" made with options",this.options)}return b.prototype.render=function(){var a,b;return a="centered"===this.options.orientation?"":"tourbus-arrow",this.$el.addClass(" "+a+" tourbus-arrow-"+this.options.orientation+" "),b="<div class='tourbus-leg-inner'>\n  "+this.content+"\n</div>",this.$el.css({width:this.options.width}).html(b),this},b.prototype.destroy=function(){return this.$el.remove(),this._teardownEvents()},b.prototype.reposition=function(){return this._configureTarget(),this._position()},b.prototype._position=function(){var a,b,c,d;return"centered"!==this.options.orientation&&(c={},b={top:"left",bottom:"left",left:"top",right:"top"},"number"==typeof this.options.arrow&&(this.options.arrow+="px"),c[b[this.options.orientation]]=this.options.arrow,d="#"+this.id+".tourbus-arrow",this.bus._log("adding rule for "+this.id,c),g(""+d+":before, "+d+":after",c)),a=this._offsets(),this.bus._log("setting offsets on leg",a),this.$el.css(a)},b.prototype.show=function(){return this.$el.css({visibility:"visible",opacity:1,zIndex:9999}),this.scrollIntoView()},b.prototype.hide=function(){return this.bus.options.debug?this.$el.css({visibility:"visible",opacity:.4,zIndex:0}):this.$el.css({visibility:"hidden"})},b.prototype.scrollIntoView=function(){var b;if(this.willScroll)return b=j(this.options.scrollTo,this.$el),this.bus._log("scrolling to",b,this.scrollSettings),a.scrollTo(b,this.scrollSettings)},b.prototype._setupOptions=function(){var a;return a=this.bus.options.leg,this.options.top=j(this.rawData.top,a.top),this.options.left=j(this.rawData.left,a.left),this.options.scrollTo=j(this.rawData.scrollTo,a.scrollTo),this.options.scrollSpeed=j(this.rawData.scrollSpeed,a.scrollSpeed),this.options.scrollContext=j(this.rawData.scrollContext,a.scrollContext),this.options.margin=j(this.rawData.margin,a.margin),this.options.arrow=this.rawData.arrow||a.arrow,this.options.align=this.rawData.align||a.align,this.options.width=this.rawData.width||a.width,this.options.orientation=this.rawData.orientation||a.orientation},b.prototype._configureElement=function(){return this.id="tourbus-leg-id-"+this.bus.id+"-"+this.options.index,this.$el=a("<div class='tourbus-leg'></div>"),this.el=this.$el[0],this.$el.attr({id:this.id}),this.$el.css({zIndex:9999})},b.prototype._setupEvents=function(){return this.$el.on("click",".tourbus-next",a.proxy(this.bus.next,this.bus)),this.$el.on("click",".tourbus-prev",a.proxy(this.bus.prev,this.bus)),this.$el.on("click",".tourbus-stop",a.proxy(this.bus.stop,this.bus))},b.prototype._teardownEvents=function(){return this.$el.off("click")},b.prototype._configureTarget=function(){return this.targetOffset=this.$target.offset(),j(this.options.top,!1)&&(this.targetOffset.top=this.options.top),j(this.options.left,!1)&&(this.targetOffset.left=this.options.left),this.targetWidth=this.$target.outerWidth(),this.targetHeight=this.$target.outerHeight()},b.prototype._configureScroll=function(){return this.willScroll=a.fn.scrollTo&&this.options.scrollTo!==!1,this.scrollSettings={offset:-this.options.scrollContext,easing:"linear",axis:"y",duration:this.options.scrollSpeed}},b.prototype._offsets=function(){var b,c,d,e,f,g,h,i;switch(d=this.$el.height(),e=this.$el.width(),f={},this.options.orientation){case"centered":h=a(window).height(),f.top=this.options.top,j(f.top,!1)||(f.top=h/2-d/2),f.left=this.targetWidth/2-e/2;break;case"left":f.top=this.targetOffset.top,f.left=this.targetOffset.left-e-this.options.margin;break;case"right":f.top=this.targetOffset.top,f.left=this.targetOffset.left+this.targetWidth+this.options.margin;break;case"top":f.top=this.targetOffset.top-d-this.options.margin,f.left=this.targetOffset.left;break;case"bottom":f.top=this.targetOffset.top+this.targetHeight+this.options.margin,f.left=this.targetOffset.left}if(i={top:["left","right"],bottom:["left","right"],left:["top","bottom"],right:["top","bottom"]},k(this.options.orientation,i[this.options.align]))switch(this.options.align){case"right":f.left+=this.targetWidth-e;break;case"bottom":f.top+=this.targetHeight-d}else"center"===this.options.align&&(k(this.options.orientation,i.left)?(g=this.targetWidth/2,c=e/2,b="left"):(g=this.targetHeight/2,c=d/2,b="top"),g>c?f[b]+=g-c:f[b]-=c-g);return f},b}(),l=0,f=function(){return l++},i={},h=function(){var a;return a=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,arguments,function(){}),i[a.id]=a,a},j=function(a,b){return null===a||"undefined"==typeof a?b:a},k=function(b,c){return-1!==a.inArray(b,c||[])},g=function(b){var c;return b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b),c=document.styleSheets[document.styleSheets.length-1],function(b,d){var e,f;f=a.map(function(){var a;a=[];for(e in d)a.push(e);return a}(),function(a){return""+a+":"+d[a]}).join(";");try{c.insertRule?c.insertRule(""+b+" { "+f+" }",(c.cssRules||c.rules).length):c.addRule(b,f)}catch(g){}}}(document.createElement("style"))}(jQuery),$(document).ready(function(){var a,b;return b=$("#new-task"),a=function(){var a,c;return a=Task.getAllTasks(),Views.showTasks(a),b.focus(),$("body").css("opacity","100"),c=$("#tour").tourbus({onStop:Views.finishTour}),null===localStorage.getItem("sst-tour")&&$(window).width()>600&&a.length>0?c.trigger("depart.tourbus"):void 0},$("#task-submit").click(function(a){var c;return a.preventDefault(),c=b.val(),Task.setNewTask(c),$("#new-task").val("")}),$("#mark-all-done").click(function(a){var b;return a.preventDefault(),b=Task.getAllTasks(),0===b.length?confirm("No tasks to mark done!"):confirm("Are you sure you want to mark all tasks as done?")?Task.markAllDone():void 0}),$("#undo").click(function(){return Task.undoLast()}),$(document).on("click","#task-list li label input",function(){var a;return a=$(this).closest("li"),a.slideToggle(function(){return Task.markDone(Views.getId(a))})}),$(document).on("click",".priority, .duedate",function(a){var b,c,d;return c=$(a.currentTarget).attr("type"),d=$(this).attr(c),b=$(this).closest("li"),Task.changeAttr(b,c,d)}),a()});var Arrays,DB,Task;DB=function(){function a(){}return a.db_key="todo",a}(),Arrays=function(){function a(){}return a.priorities=["minor","major","blocker"],a.duedates=["today","tomorrow","this week","next week","this month"],a.default_data=[{isDone:!1,name:"Add a new task above",priority:"major",duedate:"today"},{isDone:!1,name:"Perhaps give it a priority or due date",priority:"minor",duedate:"today"},{isDone:!1,name:"Refresh to see that your task is still here",priority:"minor",duedate:"today"},{isDone:!1,name:'Follow <a href="http://twitter.com/humphreybc" target="_blank">@humphreybc</a> on Twitter',priority:"major",duedate:"today"},{isDone:!1,name:"Click a taskâ€™s name to complete it",priority:"minor",duedate:"tomorrow"}],a}(),Task=function(){function a(){}return a.getAllTasks=function(){var a,b,c,d,e,f;if(a=localStorage.getItem(DB.db_key),a=JSON.parse(a)||Arrays.default_data,a.length>0&&void 0===a[0].priority)for(b=e=0,f=a.length;f>e;b=++e)d=a[b],c=a[b].name,a[b]=this.createTask(c),this.setAllTasks(a);return a},a.createTask=function(a){var b;return b={isDone:!1,name:a,priority:"minor",duedate:"today"}},a.setNewTask=function(a){var b,c;return""!==a?(c=this.createTask(a),b=this.getAllTasks(),b.push(c),this.setAllTasks(b)):void 0},a.setAllTasks=function(a){return localStorage.setItem(DB.db_key,JSON.stringify(a)),Views.showTasks(a)},a.changeAttr=function(a,b,c){var d,e;return"priority"===b?d=Arrays.priorities:"duedate"===b&&(d=Arrays.duedates),e=$.inArray(c,d),e===d.length-1&&(e=-1),c=d[e+1],this.updateAttr(a,b,c)},a.updateAttr=function(a,b,c){var d,e,f;return e=Views.getId(a),d=this.getAllTasks(),f=d[e],f[b]=c,this.setAllTasks(d)},a.undoLast=function(){var a,b,c;return c=localStorage.getItem("undo"),c=JSON.parse(c),a=this.getAllTasks(),b=c.position,delete c.position,a.splice(b,0,c),this.setAllTasks(a),localStorage.removeItem("undo"),Views.undoUX(a)},a.markDone=function(a){var b,c;return b=this.getAllTasks(),c=b[a],c.position=a,localStorage.setItem("undo",JSON.stringify(c)),Views.undoFade(),b=this.getAllTasks(),b.splice(a,1),this.setAllTasks(b)},a.markAllDone=function(){var a;return this.setAllTasks([]),a=this.getAllTasks(),Views.showTasks(a)},a}();var Views;Views=function(){function a(){}var b;return b=0,a.getId=function(a){var b;return b=$(a).find("input").attr("id").replace("task",""),parseInt(b)},a.generateHTML=function(a){var b,c,d,e,f;for(d=[],b=e=0,f=a.length;f>e;b=++e)c=a[b],d[b]='<li><label><input type="checkbox" id="task'+b+'" />'+c.name+'</label><a class="duedate" type="duedate" duedate="'+c.duedate+'">'+c.duedate+'</a><a class="priority" type="priority" priority="'+c.priority+'">'+c.priority+"</a></li>";return d},a.showTasks=function(a){var b;return b=this.generateHTML(a),$("#task-list").html(b),0===a.length?($("#all-done").show(),$("#new-task").focus()):$("#all-done").hide()},a.undoFade=function(){return $("#undo").fadeIn(),b=setTimeout(function(){return $("#undo").fadeOut(),localStorage.removeItem("undo")},5e6)},a.undoUX=function(a){return this.showTasks(a),clearTimeout(b),$("#undo").fadeOut()},a.finishTour=function(){return localStorage.setItem("sst-tour",1)},a}();